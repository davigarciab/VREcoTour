<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Tour Virtual 360°</title>
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <style>
      body { margin: 0; }
    </style>
  </head>
  <body>
    <a-scene vr-mode-ui="enabled: true">

      <!-- IMAGEM 360° -->
      <a-sky id="sky"
             src="cenas/01.jpg"
             rotation="0 -90 0"
             crossorigin="anonymous">
      </a-sky>

      <!-- BOTÃO IMAGEM: PRÓXIMA CENA -->
      <a-image id="btnNext"
               src="assets/direita.png"
               material="color: white"
               position="1.6 1.6 -3"
              
               width="0.5"
               height="0.5"
               class="clickable">
      </a-image>

      <!-- BOTÃO IMAGEM: VOLTAR CENA -->
      <a-image id="btnBack"
               src="assets/esqurda.png"
               
               material="color: white"
               position="-1.6 1.6 -3"
               
               width="0.5"
               height="0.5"
               class="clickable">
      </a-image>

      <!-- CÂMERA COM CURSOR -->
      <a-entity camera look-controls wasd-controls position="0 1.6 0">
        <a-entity cursor="fuse: true; fuseTimeout: 1000"
                  position="0 0 -1"
                  geometry="primitive: ring; radiusInner: 0.02; radiusOuter: 0.03"
                  material="color: yellow; shader: flat">
        </a-entity>
      </a-entity>

    </a-scene>

    <script>
      // Debug: log erros globais de recursos
      window.addEventListener('error', (e) => {
        try {
          console.error('[GLOBAL ERROR]', e.message || e, e);
        } catch (_) {}
      }, true);

      const imagens = [
        "cenas/01.jpg",
        "cenas/02.jpg",
        "cenas/03.jpeg",
        "cenas/04.jpg",
        "cenas/05.jpeg",
        "cenas/06.jpg"
      ];

      let indiceAtual = 0;
      const sky = document.querySelector('#sky');
      const btnNext = document.querySelector('#btnNext');
      const btnBack = document.querySelector('#btnBack');

      // Debug: eventos do material do A-Frame
      sky.addEventListener('materialtextureloaded', (e) => {
        console.log('[A-FRAME] textura carregada', { src: sky.getAttribute('src'), detail: e.detail });
      });
      sky.addEventListener('materialtextureerror', (e) => {
        console.error('[A-FRAME] erro ao carregar textura', { src: sky.getAttribute('src'), detail: e.detail });
      });

      // Pré-carregamento simples com CORS
      function preloadImages(urls) {
        urls.forEach((url, idx) => {
          const img = new Image();
          img.crossOrigin = 'anonymous';
          img.onload = async () => {
            console.log('[PRELOAD] onload', { idx, url, width: img.naturalWidth, height: img.naturalHeight });
            if (img.decode) {
              try {
                await img.decode();
                console.log('[PRELOAD] decode OK', { idx, url });
              } catch (err) {
                console.warn('[PRELOAD] decode falhou', { idx, url, err });
              }
            }
          };
          img.onerror = (err) => {
            console.error('[PRELOAD] onerror', { idx, url, err });
          };
          img.src = url;
        });
      }
      preloadImages(imagens);

      btnNext.addEventListener('click', () => {
        indiceAtual = (indiceAtual + 1) % imagens.length;
        const nextSrc = imagens[indiceAtual];
        console.log('[NAV] next', { indiceAtual, nextSrc });
        sky.setAttribute('src', nextSrc);
      });

      btnBack.addEventListener('click', () => {
        indiceAtual = (indiceAtual - 1 + imagens.length) % imagens.length;
        const prevSrc = imagens[indiceAtual];
        console.log('[NAV] back', { indiceAtual, prevSrc });
        sky.setAttribute('src', prevSrc);
      });
    </script>
  </body>
</html>
